<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cafe Website</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
/* Global Reset */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: Arial, sans-serif;
}

body {
    background-color: #f4f4f4;
    padding: 20px;
    color: #333; /* Default body text color */
}

/* Navigation */
nav {
    background-color: #333;
    padding: 10px 0;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

nav ul {
    list-style: none;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
}

nav ul li {
    margin: 0 15px;
    position: relative;
}

nav ul li a {
    color: #fff;
    text-decoration: none;
    font-size: 18px;
    font-weight: 500;
    padding: 10px 20px;
    border-radius: 5px;
    transition: all 0.3s ease;
}

nav ul li a:hover {
    color: #ff9800;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    background-color: rgba(255, 152, 0, 0.1);
    transform: translateY(-3px);
}

nav ul li a::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background-color: #ff9800;
    transition: width 0.3s ease;
}

nav ul li a:hover::after {
    width: 100%;
}

/* Headings */
h1 {
    color: #333;
    text-align: center;
    margin-bottom: 20px;
}

/* Sections */
section {
    display: none;
}

.active {
    display: block;
}

/* Menu Grid */
.menu-items {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-top: 20px;
    justify-items: center;
}

/* Menu Items */
.menu-item {
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    width: 100%;
    max-width: 320px;
}

.menu-item:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.menu-item img {
    width: 100%;
    height: 250px;
    object-fit: cover;
    border-radius: 8px;
    transition: transform 0.3s ease;
    display: block;
    margin: 0 auto;
}

.menu-item img:hover {
    transform: scale(1.1);
}

.menu-item h3 {
    margin: 10px 0;
    color: #333;
}

.menu-item p {
    color: #555;
}

.menu-item button {
    background: #333;
    color: #fff;
    padding: 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    margin-top: 10px;
    width: 100%;
}

.menu-item button:hover {
    background-color: #555;
}

/* Booking/Contact Section Overrides for better visibility */
#booking, #contact {
    max-width: 600px;
    margin: 40px auto;
    padding: 40px;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    background-color: #fff; /* Ensure forms are readable */
}

#booking h1, #contact h1 {
    color: #333;
}

#booking input, #booking textarea, #contact input, #contact textarea {
    background-color: #f9f9f9 !important;
}

/* Footer */
footer {
    text-align: center;
    margin-top: 40px;
    color: #333;
}

/* Responsive Breakpoints */
@media screen and (max-width: 1024px) {
    .menu-items {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media screen and (max-width: 768px) {
    nav ul li {
        margin: 5px 10px;
    }

    .menu-items {
        grid-template-columns: 1fr;
    }

    .menu-item img {
        height: 200px;
    }
}


/* ========================================================================= */
/* AI Chatbot Styles */
/* Apply Chatbot-specific styles only to Chatbot elements to avoid conflicts */
:root {
    --accent: #00bcd4; /* Cyan/Teal Accent */
    --glow-accent: #5ee7ff;
    --muted: #a0e7ff;
}

/* Button & input styles for Chatbot */
#chatPopup button {
    font-family: Poppins, system-ui, Segoe UI, Arial;
    padding: 6px 14px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    background: linear-gradient(90deg,var(--accent),#3ec8ff);
    color: #001;
    font-weight: 700;
    transition: 0.3s;
}
#chatPopup .btn.ghost {
    background:transparent;
    border:1px solid rgba(255,255,255,0.06);
    color:var(--muted);
}

/* Floating chat Toggle */
#chatToggle {
    position: fixed;
    bottom: 22px;
    right: 22px;
    width: 70px;
    height: 70px;
    background: linear-gradient(135deg,#04202b,#004d66);
    border-radius: 999px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 1000;
    box-shadow: 0 0 20px rgba(0,255,255,0.3), 0 8px 18px rgba(0,0,0,0.6);
    color: var(--glow-accent);
    font-size: 30px;
    transition: 0.3s;
    font-family: Arial, sans-serif; /* Use a common font for the icon */
}
#chatToggle:hover {
    transform: scale(1.1);
    box-shadow: 0 0 25px var(--glow-accent), 0 10px 20px rgba(0,0,0,0.6);
}

/* Chat Popup Window */
#chatPopup {
    display: none;
    position: fixed;
    bottom: 100px;
    right: 22px;
    width: 400px;
    max-height: 520px;
    background: linear-gradient(180deg,#0c1b28,#07141a);
    border-radius: 14px;
    box-shadow: 0 20px 60px rgba(0,255,255,0.2), 0 10px 30px rgba(0,0,0,0.7);
    flex-direction: column;
    overflow: hidden;
    z-index: 1000;
    border: 1px solid rgba(255,255,255,0.04);
    animation: popupFade 0.4s ease forwards;
    font-family: Poppins, system-ui, Segoe UI, Arial;
    color: #e6eef6; /* Text color inside popup */
}
@keyframes popupFade {
    from { transform: translateY(20px); opacity:0; }
    to { transform: translateY(0); opacity:1; }
}

#chatBody {
    flex: 1;
    overflow-y: auto;
    padding: 14px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}
#chatBody::-webkit-scrollbar { width: 6px; }
#chatBody::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }

/* Chat Messages */
.msg {
    padding: 10px 14px;
    border-radius: 12px;
    max-width: 75%;
    white-space: pre-wrap;
    position: relative;
    font-weight: 500;
    animation: msgFade 0.3s ease forwards;
}
.msg.user {
    background: linear-gradient(90deg,#1a2b3c,#0f2230);
    align-self: flex-end;
    color: #5ee7ff;
    box-shadow: 0 0 12px rgba(94,231,255,0.4);
}
.msg.bot {
    background: linear-gradient(90deg,#0f1b22,#081018);
    align-self: flex-start;
    border: 1px solid rgba(94,231,255,0.05);
    color: #a0e7ff;
    box-shadow: inset 0 0 10px rgba(94,231,255,0.1);
}
@keyframes msgFade {
    from { opacity:0; transform: translateY(10px); }
    to { opacity:1; transform: translateY(0); }
}

/* Chat Input and Controls */
#userInput {
    width: calc(100% - 24px);
    padding: 12px;
    margin:8px 12px;
    border-radius:10px;
    border:none;
    background: rgba(255,255,255,0.05);
    color: inherit;
    outline:none;
    box-shadow: inset 0 0 8px rgba(0,255,255,0.1);
    transition:0.3s;
}
#userInput:focus {
    background: rgba(94,231,255,0.06);
    box-shadow: 0 0 12px var(--glow-accent);
}
#chatControls {
    display:flex;
    justify-content:space-between;
    padding:6px 12px;
}

/* Typing Indicator (Dots) */
.dots {
    display: flex;
    align-items: center;
    gap: 4px;
}
.dots span {
    width: 6px;
    height: 6px;
    background-color: #a0e7ff;
    border-radius: 50%;
    animation: bounce 1.2s infinite ease-in-out;
}
.dots span:nth-child(2) {
    animation-delay: 0.2s;
}
.dots span:nth-child(3) {
    animation-delay: 0.4s;
}
@keyframes bounce {
    0%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-8px); }
}

/* Contact Status/Message */
.muted {
    font-size: 0.9em;
    color: #777;
    text-align: center;
    margin-top: 10px;
}
#status {
    color: #007bff; /* Blue for status messages */
    font-weight: bold;
}
    </style>
    
</head>
<body>

    <nav>
        <ul>
            <li><a href="#" onclick="showSection('menu')">Menu</a></li>
            <li><a href="#" onclick="showSection('booking')">Booking</a></li>
            <li><a href="#" onclick="showSection('about')">About</a></li>
            <li><a href="#" onclick="showSection('contact')">Contact</a></li>
        </ul>
    </nav>

    <section id="menu" class="menu active">
        <h1>Our Menu</h1>
        <div class="menu-items" id="menu-items"></div>
    </section>

    <section id="booking">
        <h1 style="text-align: center; color: #2c3e50; margin-bottom: 20px; font-family: 'Arial', sans-serif;">Book a Table</h1>
        <form id="booking-form" style="display: flex; flex-direction: column; gap: 15px;">
            <input 
                type="text" 
                id="name" 
                placeholder="Your Name" 
                required 
                style="padding: 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; background-color: #fff; font-family: 'Arial', sans-serif;"
            >
            <input 
                type="email" 
                id="email" 
                placeholder="Your Email" 
                required 
                style="padding: 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; background-color: #fff; font-family: 'Arial', sans-serif;"
            >
            <input 
                type="datetime-local" 
                id="booking-time" 
                required 
                style="padding: 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; background-color: #fff; font-family: 'Arial', sans-serif;"
            >
            <textarea 
                id="special-request" 
                placeholder="Special Requests" 
                rows="4" 
                style="padding: 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; background-color: #fff; font-family: 'Arial', sans-serif; resize: none;"
            ></textarea>
            <button 
                type="submit" 
                style="background-color: #3498db; color: #fff; padding: 12px; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; transition: background-color 0.3s ease; font-family: 'Arial', sans-serif;"
            >
                Submit Booking
            </button>
        </form>
    </section>

    <section id="about" style="background-color: #fff; padding: 40px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); margin-top: 40px;">
        <h1 style="color: #333; font-family: 'Arial', sans-serif; text-align: center;">About Us</h1>
        
        <h2 style="color: #333; font-size: 24px; margin-top: 30px; font-family: 'Arial', sans-serif;">Our Café Experience</h2>
        <p style="color: #555; font-size: 18px; line-height: 1.6; margin-top: 20px;">
            Welcome to our cozy cafe, where every cup of coffee tells a story, and every bite of food is crafted with love. We believe in offering a warm and welcoming space for everyone—from coffee lovers to food enthusiasts. Our cafe is designed with a modern yet relaxed ambiance, creating the perfect environment to relax, catch up with friends, or even get some work done.
        </p>
        
        <h2 style="color: #333; font-size: 24px; margin-top: 30px; font-family: 'Arial', sans-serif;">Delicious Menu</h2>
        <p style="color: #555; font-size: 18px; line-height: 1.6; margin-top: 20px;">
            At our cafe, we believe that food is an experience. That's why we carefully curate our menu with a variety of delicious, fresh, and high-quality meals and beverages. Whether you're in the mood for a hot cup of espresso, a sweet treat like a muffin, or a refreshing smoothie, we have something to satisfy every craving. We also cater to special dietary needs with options for vegan, gluten-free, and dairy-free diets.
        </p>
        
        <h2 style="color: #333; font-size: 24px; margin-top: 30px; font-family: 'Arial', sans-serif;">Our Passionate Team</h2>
        <p style="color: #555; font-size: 18px; line-height: 1.6; margin-top: 20px;">
            Our team is passionate about coffee, food, and hospitality. With years of experience in the food and beverage industry, we are committed to delivering exceptional service to all our guests. From the moment you walk through our doors, you'll be greeted with a smile and treated like family. Whether you’re here for a quick bite or to unwind after a long day, we want you to feel at home.
        </p>
        
        <h2 style="color: #333; font-size: 24px; margin-top: 30px; font-family: 'Arial', sans-serif;">Community Engagement</h2>
        <p style="color: #555; font-size: 18px; line-height: 1.6; margin-top: 20px;">
            In addition to our great menu, we also host regular events such as live music nights, trivia evenings, and coffee tasting sessions. We believe in building a community around our cafe, and we love to bring people together over great food, drinks, and conversations.
        </p>
        
        <h2 style="color: #333; font-size: 24px; margin-top: 30px; font-family: 'Arial', sans-serif;">Invitation to Visit</h2>
        <p style="color: #555; font-size: 18px; line-height: 1.6; margin-top: 20px;">
            Thank you for choosing to visit our cafe. We hope to make your experience memorable and enjoyable. We invite you to explore our menu, try our signature drinks, and enjoy the warm and inviting atmosphere we’ve created just for you. Come for the coffee, stay for the experience.
        </p>
    </section>

    
    <section id="contact">
        <h1 style="text-align: center; color: #333; margin-bottom: 20px;">Contact Us</h1>
        <form id="contact-form" style="display: flex; flex-direction: column; gap: 15px;">
            <input 
                type="text" 
                id="contact-name" 
                placeholder="Your Name" 
                required 
                style="padding: 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px;"
            >
            <input 
                type="email" 
                id="contact-email" 
                placeholder="Your Email" 
                required 
                style="padding: 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px;"
            >
            <textarea 
                id="contact-message" 
                placeholder="Your Message" 
                rows="5" 
                required 
                style="padding: 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; resize: none;"
            ></textarea>
            <button 
                type="submit" 
                style="background-color: #28a745; color: white; padding: 12px; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; transition: background-color 0.3s ease;"
            >
                Submit
            </button>
        </form>
        <p class="muted" id="status" style="margin-top: 15px;"></p>
    </section>

    <div id="chatToggle">💬</div>

    <div id="chatPopup">
        <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-bottom:1px solid rgba(255,255,255,0.06)">
            <strong>Cafe AI Assistant</strong>
            <button id="closeChat" class="btn ghost">Close</button>
        </div>
        <div id="chatBody"></div>
        <div id="chatControls">
            <input id="userInput" placeholder="Ask about the menu, booking, or hours..." autofocus/>
            <button id="sendBtn">Send</button>
        </div>
    </div>
    
    <footer>
        <p>&copy; <span id="year"></span> Cafe Website. All rights reserved.</p>
    </footer>

    <script>
// =================== MENU DATA ===================
// NOTE: I replaced image URLs with placeholder tags for functionality.
// Replace these with your actual image paths!
const menuData = [
    { title: "Americano", image: "sss1.avif", description: "Black coffee with hot water", price: "$3" },
    { title: "Mocha", image: "as2.jpg", description: "Chocolate-flavored coffee", price: "$5" },
    { title: "Macchiato", image: "asad2.avif", description: "Espresso with a dollop of foam", price: "$4" },
    { title: "Iced Coffee", image: "asad3.avif", description: "Chilled coffee with ice", price: "$3.5" },
    { title: "Flat White", image: "asad4.avif", description: "Espresso with microfoam", price: "$4.5" },
    { title: "Cold Brew", image: "asad5.avif", description: "Slow-steeped cold coffee", price: "$5" },
    { title: "Muffin", image: "as7.jpg", description: "Blueberry or chocolate chip muffin", price: "$2.5" },
    { title: "Bagel", image: "as8.jpg", description: "Freshly baked bagel with cream cheese", price: "$3.5" },
    { title: "Croissant", image: "as9.jpg", description: "Flaky butter croissant", price: "$3" },
    { title: "Donut", image: "as10.jpg", description: "Glazed or chocolate donut", price: "$2.5" },
    { title: "Smoothie", image: "as11.jpg", description: "Fresh fruit blended drink", price: "$5" },
    { title: "Milkshake", image: "as12.jpg", description: "Thick and creamy milkshake", price: "$4.5" },
    { title: "Quiche", image: "as13.jpg", description: "Savory egg and cheese pastry", price: "$6" },
    { title: "Fruit Salad", image: "as14.jpg", description: "Mixed fresh fruits", price: "$4" },
    { title: "Pasta Salad", image: "as15.jpg", description: "Cold pasta with vegetables", price: "$5.5" },
];

let cart = [];
let isFormSubmitted = false;
let isWaiting = false; // Flag to prevent multiple chatbot submissions

// =================== SECTION HANDLER ===================
function showSection(sectionId) {
    document.querySelectorAll('section').forEach(section => {
        section.classList.remove('active');
    });
    // Update navigation active class (assuming you have nav links)
    document.querySelectorAll('.nav-link').forEach(nav => nav.classList.remove('active'));
    const targetSection = document.getElementById(sectionId);
    if (targetSection) {
        targetSection.classList.add('active');
        // Optional: Update nav link if it exists
        const navLink = document.querySelector(`.nav-link[data-section="${sectionId}"]`);
        if (navLink) navLink.classList.add('active');
    }
}

// =================== MENU GENERATOR ===================
function generateMenu() {
    const menuItems = document.getElementById("menu-items");
    if (!menuItems) return;

    menuItems.innerHTML = "";

    menuData.forEach(item => {
        const menuItem = document.createElement("div");
        menuItem.classList.add("menu-item");
        // Using encodeURIComponent for title in function call to handle spaces/symbols safely
        const encodedTitle = encodeURIComponent(item.title); 
        
        menuItem.innerHTML = `
            <img src="${item.image}" alt="${item.title}">
            <h3>${item.title}</h3>
            <p>${item.description}</p>
            <p><strong>${item.price}</strong></p>
            <button onclick="addToCart('${encodedTitle}', '${item.price}')">Add to Cart</button>
            <button onclick="openOrderForm('${encodedTitle}')">Buy Now</button>
        `;
        menuItems.appendChild(menuItem);
    });
}

// =================== ADD TO CART ===================
function addToCart(encodedTitle, productPrice) {
    const productTitle = decodeURIComponent(encodedTitle);
    const existingProduct = cart.find(item => item.title === productTitle);
    if (existingProduct) {
        existingProduct.quantity += 1;
    } else {
        // Price should be stored as a string "$X" or parsed to number if needed for calculation
        cart.push({ title: productTitle, price: productPrice, quantity: 1 });
    }
    alert(`${productTitle} has been added to your cart! Current Items: ${cart.reduce((total, item) => total + item.quantity, 0)}`);
}

// =================== ORDER FORM (Buy Now Popup) ===================
function openOrderForm(encodedTitle) {
    const productTitle = decodeURIComponent(encodedTitle);
    
    // Check if the form is already open or submitted
    if (isFormSubmitted) {
        alert("You have already placed an order. Please refresh to place another.");
        return;
    }
    if (document.getElementById('order-form-container')) return; // Check if already visible

    // 1. Create a semi-transparent overlay
    const overlay = document.createElement("div");
    overlay.id = 'order-overlay';
    overlay.style.cssText = "position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; cursor: pointer;";
    overlay.onclick = closeOrderForm;
    document.body.appendChild(overlay);

    // 2. Create the form container
    const orderFormContainer = document.createElement("div");
    orderFormContainer.id = 'order-form-container';
    orderFormContainer.style.cssText = `
        position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
        background: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 8px 16px rgba(0,0,0,0.2); 
        z-index: 1000; width: 90%; max-width: 400px;
    `;
    orderFormContainer.innerHTML = `
        <h3 style="color: #333; margin-bottom: 15px;">Order for ${productTitle}</h3>
        <form id="order-form" style="display: flex; flex-direction: column; gap: 10px;">
            <input type="text" id="customer-name" placeholder="Your Name" required style="padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
            <input type="email" id="customer-email" placeholder="Your Email" required style="padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
            <input type="number" id="quantity" value="1" placeholder="Quantity" required min="1" style="padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
            <textarea id="customer-address" placeholder="Your Address" rows="3" required style="padding: 10px; border: 1px solid #ccc; border-radius: 5px;"></textarea>
            <button type="submit" style="background: #28a745; color: #fff; padding: 10px; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">Place Order</button>
        </form>
        <button onclick="closeOrderForm()" style="margin-top: 15px; background: #dc3545; color: #fff; padding: 10px; border: none; border-radius: 5px; cursor: pointer; width: 100%;">Cancel</button>
    `;
    document.body.appendChild(orderFormContainer);

    // 3. Handle form submission
    document.getElementById("order-form").addEventListener("submit", function(e) {
        e.preventDefault();
        const name = document.getElementById("customer-name").value;
        const email = document.getElementById("customer-email").value;
        const quantity = document.getElementById("quantity").value;
        const address = document.getElementById("customer-address").value;

        alert(`Order Placed Successfully! ✅\n\nProduct: ${productTitle} x ${quantity}\nName: ${name}\nEmail: ${email}\nAddress: ${address}\n\nNOTE: This is a demo. No actual order was placed. Refresh the page to place a new order.`);
        isFormSubmitted = true;
        closeOrderForm();
    });
}

function closeOrderForm() {
    const overlay = document.getElementById('order-overlay');
    const container = document.getElementById('order-form-container');
    if (overlay) overlay.remove();
    if (container) container.remove();
}

// =================== CONTACT FORM (LOCAL STORAGE) ===================
const contactForm = document.getElementById('contact-form');
const statusDiv = document.getElementById('status'); 

if (contactForm && statusDiv) {
    contactForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const name = document.getElementById('contact-name').value.trim();
        const email = document.getElementById('contact-email').value.trim();
        const message = document.getElementById('contact-message').value.trim();
        
        if(!name || !email || !message) {
            setStatus('Please fill all fields', 'red');
            return;
        }
        
        // Simple local storage mock for saving message
        const store = JSON.parse(localStorage.getItem('cafe_messages') || '[]');
        store.push({name, email, message, at: new Date().toISOString()});
        localStorage.setItem('cafe_messages', JSON.stringify(store));
        
        setStatus('Message saved locally. Thank you for contacting us! We will be in touch.', 'green');
        contactForm.reset();
    });
}


function setStatus(t, color) {
    if (statusDiv) {
        statusDiv.innerText = t;
        statusDiv.style.color = color;
        setTimeout(() => { statusDiv.innerText = ''; }, 4000);
    }
}

// =================== CHATBOT LOGIC ===================
const toggle = document.getElementById('chatToggle');
const popup = document.getElementById('chatPopup');
const closeBtn = document.getElementById('closeChat');
const input = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const chatBody = document.getElementById('chatBody');

let isOpen = false;

// Data for simple, local answers 
const localData = {
    "hello": "Hello there! Welcome to our cafe. How can I help you today?",
    "hi": "Hi! Feel free to ask about our cafe, menu, or how to book a table.",
    "about": "Our cafe offers a cozy and welcoming space where every cup of coffee tells a story. We serve high-quality meals, coffee, and desserts in a relaxed modern environment.",
    "menu": "Our menu includes espresso, mocha, muffins, sandwiches, smoothies, and vegan-friendly options. Everything is made fresh and with quality ingredients.",
    "booking": "You can easily book a table on our Booking page by entering your name, email, preferred date, time, and any special requests.",
    "contact": "You can reach us through the Contact page by filling out your name, email, and message. We’ll get back to you soon.",
    "thanks": "You're welcome! We’re happy to help. Feel free to ask anything else about our cafe or services.",
    "bye": "Goodbye! Hope to see you soon at our cafe.",
    "hours": "We are open from 7 AM to 9 PM, Monday to Saturday.",
    "location": "We’re located in the heart of the city, offering a cozy spot for coffee and meals. Check our website for directions."
};

// Event listeners for chat interface
if (toggle) {
    toggle.onclick = () => {
        isOpen = !isOpen;
        popup.style.display = isOpen ? 'flex' : 'none';
        if (isOpen) {
            input.focus();
            if (chatBody.children.length === 0) {
                // Initial welcome message
                appendMessage("Hello! I'm your Cafe Assistant. How can I help you today? Try asking about our 'Mocha' or 'opening hours'.", 'bot');
            }
        }
    };
    closeBtn.onclick = () => { popup.style.display = 'none'; isOpen = false; };

    input.addEventListener('keydown', e => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); } });
    sendBtn.onclick = handleSend;
}


function appendMessage(txt, cls) {
    const div = document.createElement('div');
    div.className = 'msg ' + cls;
    div.textContent = txt;
    chatBody.appendChild(div);
    chatBody.scrollTop = chatBody.scrollHeight;
    return div;
}


async function handleSend() {
    if (isWaiting) return;
    const text = input.value.trim();
    if (!text) return;
    input.value = '';
    appendMessage(text, 'user');
    isWaiting = true;
    sendBtn.disabled = true;

    // Typing indicator
    const temp = document.createElement('div');
    temp.className = 'msg bot';
    // Using a simpler text indicator that can be easily replaced by streaming text
    temp.textContent = '...Thinking (Connecting to AI)...'; 
    chatBody.appendChild(temp);
    chatBody.scrollTop = chatBody.scrollHeight;

    const lowerText = text.toLowerCase();
    let localAnswer = null;

    // 1. Check local data for quick answers
    for (const key in localData) {
        // Check if the query contains the local data key
        if (lowerText.includes(key)) {
            localAnswer = localData[key];
            break;
        }
    }

    if (localAnswer) {
        // Use a short timeout for a more 'human' feel
        await new Promise(resolve => setTimeout(resolve, 500)); 
        temp.textContent = localAnswer;
        chatBody.scrollTop = chatBody.scrollHeight;
        isWaiting = false;
        sendBtn.disabled = false;
    } else {
        // 2. Ollama AI fallback
        const systemPrompt = "You are the helpful Cafe AI Assistant. Your name is 'Cafe AI Assistant'. Answer questions about the cafe menu, location, and services. Keep your responses short, friendly, and simple. If the question is outside of a cafe's typical scope, politely say you only handle cafe-related questions.";
        
        try {
            // Attempt to connect to a local Ollama server (phi3:latest model)
            const payload = { model: "phi3:latest", messages: [{ role: "system", content: systemPrompt }, { role: "user", content: text }], stream: true };
            const res = await fetch("http://localhost:11434/api/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            if (!res.ok) {
                temp.textContent = "Error: Could not connect to the local AI server (Ollama). Please check if Ollama is running and the model 'phi3:latest' is downloaded.";
            } else {
                const reader = res.body.getReader();
                const decoder = new TextDecoder();
                let output = "";
                
                temp.textContent = ''; // Clear indicator once connected
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value);
                    const lines = chunk.split("\n").filter(Boolean);
                    
                    for (const line of lines) {
                        try {
                            const json = JSON.parse(line);
                            const content = json?.message?.content;
                            if (content) {
                                output += content;
                                temp.textContent = output;
                                chatBody.scrollTop = chatBody.scrollHeight;
                            }
                        } catch (e) {
                            // Ignore non-JSON lines or parsing errors
                        }
                    }
                }
                
                if (output === "") {
                    temp.textContent = "I received a blank answer from the AI. Please try rephrasing.";
                }
            }
        } catch (err) {
            temp.textContent = "Connection Error: Make sure your local AI server (Ollama) is running on http://localhost:11434.";
        } finally {
            isWaiting = false;
            sendBtn.disabled = false;
        }
    }
}


// =================== PAGE LOAD ===================
window.onload = function() {
    // Set the current year in the footer
    const yearElement = document.getElementById('year');
    if (yearElement) {
        yearElement.innerText = new Date().getFullYear();
    }
    
    // Generate menu items
    generateMenu();
    
    // Initially show the Menu section
    showSection('menu'); 
};
    </script>
    
</body>
</html>